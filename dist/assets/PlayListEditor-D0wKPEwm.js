import{_ as z,t as f,j as b,k as _,c as y,d as l,n as k,l as C,m as g,w as d,V as u,e as a,i as v,a as h,p as x,q as S,s as R,r as P,o as m,F as N,u as L}from"./index-CqTxoDZw.js";import{g as w}from"./index-ZORhgBxb.js";const O={name:"TestVue",data(){return{template:{},layoutName:null,layout:null,viewersRatio:.5,playlistName:null,playlist:null,loading:!1,currentData:null,currentDefinition:null,selectedItem:null,previewPaneWidth:0,templateServer:"",dirty:!1,preview:{},main:{},channels:{},activeChannel:null}},methods:{GetTemplateUrl(t){if(!this.layout)return"";var e=f.buildUrl(this.templateServer,this.layout,t);return e},SetActiveChannel(t){console.log("SET ACTIVE CHANNEL ",t),this.activeChannel=t,Object.keys(this.channels).forEach(e=>{this.channels[e].active=!1}),t!=null&&(t.active=!0)},SavePlayList(){console.log("save playlist "),f.savePlayList(this.layoutName,this.playlistName,this.playlist).then(t=>{this.origPlayList=JSON.stringify(this.playlist),this.checkDirty(),console.log("success")},t=>{console.log("SHIT",t)})},GetRouteUrl(){var t=this.$router.resolve({name:"cgtest"});return t.href},isObject(t){return t!=null&&typeof t=="object"},isDeepEqual(t,e){const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(var i of r){const s=t[i],c=e[i],o=this.isObject(s)&&this.isObject(c);if(this.isObjects&&!this.isDeepEqual(s,c)||!o&&s!==c)return!1}return!0},LoadPlayList(){this.loading=!1,console.log("load playlist ",this.layoutName,this.playlistName),f.getPlayList(this.layoutName,this.playlistName).then(t=>{this.playlist=t,this.origPlayList=JSON.stringify(t)}),f.getLayoutDefinition(this.layoutName).then(t=>{console.log("GetLayoutDefinition ok"),this.layout=t,this.loading=!1,this.resizeViewers()},t=>{console.log("AN ERROR OCCURED ",t)})},GetQueryParameters(){return this.$route.query},setViewersRatio(t){this.viewersRatio=t,setTimeout(()=>{this.resizeViewers()},0)},GetCurrentChannel(){return this.activeChannel},SendCommand(t,e,r,n,i,s,c){switch(console.log("send command ",e,"/",n," on layer ",r),i&&i=="off"&&(c=!0),r||(r="default"),e){case"cls":t.state={};break;case"play":c?delete t.state[r]:t.state[r]={template:n,action:i,data:s};break}setTimeout(()=>{switch(t.mode){case"direct":var o=this.$refs[t.channel];console.log("frame = ",o);var p={command:e,page:n,action:i,data:b(s),layer:r};o.contentWindow.postMessage(p,"*");break;default:console.log("lala??"),f.command(t,e,r,n,i,s==null?null:b(s));break}},0)},processCommand(t){console.log("process command",t);var e=this.GetCurrentChannel();if(e!=null){var r=t.item;switch(t.action){case"off":this.SendCommand(e,"play",r.layer,null,"off",null,!0);break;default:this.SendCommand(e,"play",r.layer,r.template,r.action,r.data,!1);break}}},ObjectChanged(t,e){console.log("change occured",e),this.selectedItem!=null&&(this.selectedItem.data=e)},OpenObjectEditor(){var t=this.$refs.objEditor;console.log("ok? ",t),t.Edit(this.obj,this.definition,"Hello").then(e=>{console.log("object editor reply: ",e),e.key=="OK"&&(this.obj=e.data)})},GetTemplate(){f.get("WBD").then(t=>{this.template=t,console.log("resolution of template: ",this.template)})},setBackground(t,e){w.set(this.$refs[t],{"background-color":e})},getElementWidth(t){var e=getComputedStyle(t),r=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),n=parseFloat(e.borderLeftWidth)+parseFloat(e.borderRightWidth);return t.offsetWidth-r-n},checkDirty(){this.playlist?this.dirty=JSON.stringify(this.playlist)!==this.origPlayList:this.dirty=!1},resizeViewers(){var t=this.$el.querySelectorAll(".viewer");console.log("resize viewers",t.length),t.forEach(e=>{if(this.layout){var r=this.getElementWidth(e.parentNode),n=this.layout.resolution[0]/this.layout.resolution[1],i=r/this.layout.resolution[0];console.log("viewer ",r,this.layout.resolution[0],n);var s=e.querySelectorAll("iframe");console.log("IFrame ",r,r/n),w.set(e,{width:r,height:r/n}),w.set(s,{scale:i,width:this.layout.resolution[0],height:this.layout.resolution[1]})}})}},mounted:function(){this.templateServer=this.$route.query.ts,this.preview=f.parseChannel(this.$route.query.p,"preview","Preview"),this.main=f.parseChannel(this.$route.query[1],"main","Main"),this.SetActiveChannel(this.preview),this.channels.P=this.preview,this.channels[1]=this.main,console.log("document ",document),document.addEventListener("keydown",function(e){if(e.key=="F1"||e.key=="F2")return console.log("keydown: ",e.key,e),e.preventDefault(),!1},!0),console.log("playlist mounted: ",this.$route.query),this.$route.query.env&&_.setEnv(this.$route.query.env),this.layoutName=this.$route.params.layout,this.playlistName=this.$route.params.playlist,this.LoadPlayList(),this.resizeObserver=new ResizeObserver(e=>{var r=e[0];w.set(this.$refs.previewPane,{width:r.contentRect.width});for(let n of e)console.log(`Size changed! New size: ${n.contentRect.width}px by ${n.contentRect.height}px`),this.previewPaneWidth=n.contentRect.width,this.resizeViewers()});var t=this.$refs.previewPaneParent;t&&this.resizeObserver.observe(t),this.dirtyInterval=setInterval(()=>this.checkDirty(),2e3)},beforeUnmount(){console.log("stop resize observer"),this.resizeObserver.unobserve(),this.dirtyInterval&&clearTimeout(this.dirtyInterval),hotkeys.unbind()},created:function(){}},E={style:{display:"flex",width:"100%"}},T={key:0},V={ref:"previewPaneParent",style:{"xbackground-color":"pink",flex:"1"}},j={key:0,class:"mb-2",style:{"background-color":"#ddd",display:"flex","align-items":"center"}},B={style:{padding:"8px"}},D=l("br",null,null,-1),G={style:{"padding-left":"50px"}},q={ref:"previewPane",style:{position:"fixed","xbackground-color":"pink",width:"100%"}},I={style:{display:"flex",width:"100%"}},U={style:{position:"relative",padding:"5px","margin-top":"8px",overflow:"hidden"}},W=["src"],A=["href"],F=l("thead",null,[l("tr",null,[l("td",null,"Layer"),l("td",null,"Scene")])],-1),H={style:{position:"relative",padding:"5px","margin-top":"8px",overflow:"hidden"}},J=["src"],K=["href"];function M(t,e,r,n,i,s){const c=P("PlaylistItemRoot");return m(),y("div",null,[l("div",E,[l("div",{style:k([{"background-color":i.dirty?"#ffdddd":""},{"max-width":"400px","min-width":"400px","padding-left":"8px","padding-right":"8px","min-height":"100vh"}])},[i.playlist?(m(),y("div",T,[i.playlist?(m(),C(c,{key:0,onCommand:s.processCommand,layout:i.layout,item:i.playlist},null,8,["onCommand","layout","item"])):g("",!0),i.dirty?(m(),C(u,{key:1,onClick:e[0]||(e[0]=o=>s.SavePlayList()),color:"primary",block:""},{default:d(()=>[a("Save")]),_:1})):g("",!0)])):g("",!0)],4),l("div",V,[i.layout?(m(),y("div",j,[l("div",B,[a(" Resolution: "),l("b",null,v(i.layout.resolution[0])+" x "+v(i.layout.resolution[1]),1),D,a(" Layout: "),l("b",null,v(i.layout.layout),1)]),l("div",G,[h(u,{class:"mr-1",size:"small",onClick:e[1]||(e[1]=o=>s.setViewersRatio(.5))},{default:d(()=>[a("50/50")]),_:1}),h(u,{class:"mr-1",size:"small",onClick:e[2]||(e[2]=o=>s.setViewersRatio(.3))},{default:d(()=>[a("30/70")]),_:1}),h(u,{size:"small",onClick:e[3]||(e[3]=o=>s.setViewersRatio(.7))},{default:d(()=>[a("70/30")]),_:1})])])):g("",!0),l("div",q,[l("div",I,[l("div",{style:k([{width:this.viewersRatio*100+"%"},{padding:"5px",overflow:"hidden"}])},[l("h3",null,v(i.preview.name)+" ("+v(i.preview.title)+") ",1),h(u,{size:"small",onClick:e[4]||(e[4]=o=>s.setBackground("viewer1","#000000"))},{default:d(()=>[a("black")]),_:1}),h(u,{size:"small",onClick:e[5]||(e[5]=o=>s.setBackground("viewer1","#ffffff"))},{default:d(()=>[a("white")]),_:1}),h(u,{size:"small",onClick:e[6]||(e[6]=o=>s.setBackground("viewer1","#ff0000"))},{default:d(()=>[a("red")]),_:1}),h(u,{size:"small",onClick:e[7]||(e[7]=o=>s.setBackground("viewer1","#aaaaaa"))},{default:d(()=>[a("grey")]),_:1}),h(u,{size:"small",color:"red",onClick:e[8]||(e[8]=o=>s.SendCommand(i.preview,"cls"))},{default:d(()=>[a("Clear")]),_:1}),l("div",U,[l("div",{class:x(["viewer",{"viewer-active":i.preview.active}]),ref:"viewer1",style:{position:"relative"}},[l("div",{onClick:e[9]||(e[9]=S(o=>s.SetActiveChannel(i.preview),["stop"])),style:{"z-index":"10",position:"absolute",width:"100%",height:"100%"}}),l("iframe",{ref:"preview",class:"cg-scaled-frame","scrolling:":"no",src:s.GetTemplateUrl(i.preview)},null,8,W)],2)]),l("a",{class:"app-link text-primary",href:s.GetTemplateUrl(i.preview),target:"_blank"},v(s.GetTemplateUrl(i.preview)),9,A),h(R,{density:"compact",hover:""},{default:d(()=>[F,l("tbody",null,[(m(!0),y(N,null,L(i.preview.state,(o,p)=>(m(),y("tr",{key:p},[l("td",null,v(p),1),l("td",null,v(o.template),1)]))),128))])]),_:1})],4),l("div",{style:k([{width:(1-this.viewersRatio)*100+"%"},{padding:"5px",overflow:"hidden"}])},[l("h3",null,v(i.main.name)+" ("+v(i.main.title)+")",1),h(u,{size:"small",onClick:e[10]||(e[10]=o=>s.setBackground("viewer2","#000000"))},{default:d(()=>[a("black")]),_:1}),h(u,{size:"small",onClick:e[11]||(e[11]=o=>s.setBackground("viewer2","#ffffff"))},{default:d(()=>[a("white")]),_:1}),h(u,{size:"small",onClick:e[12]||(e[12]=o=>s.setBackground("viewer2","#ff0000"))},{default:d(()=>[a("red")]),_:1}),h(u,{size:"small",onClick:e[13]||(e[13]=o=>s.setBackground("viewer2","#aaaaaa"))},{default:d(()=>[a("grey")]),_:1}),h(u,{size:"small",color:"red",onClick:e[14]||(e[14]=o=>s.SendCommand(i.main,"cls"))},{default:d(()=>[a("Clear")]),_:1}),l("div",H,[l("div",{class:x(["viewer",{"viewer-active":i.main.active}]),ref:"viewer2"},[l("div",{onClick:e[15]||(e[15]=S(o=>s.SetActiveChannel(i.main),["stop"])),style:{"z-index":"10",position:"absolute",width:"100%",height:"100%"}}),l("iframe",{ref:"main",style:{position:"relative",display:"relative"},class:"cg-scaled-frame","scrolling:":"no",src:s.GetTemplateUrl(i.main)},null,8,J)],2)]),l("a",{class:"app-link text-primary",href:s.GetTemplateUrl(i.main),target:"_blank"},v(s.GetTemplateUrl(i.main)),9,K)],4)])],512)],512)])])}const Y=z(O,[["render",M]]);export{Y as default};
