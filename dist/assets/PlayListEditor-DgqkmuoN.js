import{_ as N,t as y,j as b,k as O,c as p,d as l,n as k,l as x,m as g,w as u,V as d,e as h,i as c,a as o,p as S,q as _,s as z,r as L,o as v,F as R,u as P}from"./index-CCXm_6YG.js";import{g as w}from"./index-ZORhgBxb.js";const E={name:"TestVue",data(){return{template:{},layoutName:null,layout:null,viewersRatio:.5,playlistName:null,playlist:null,loading:!1,currentData:null,currentDefinition:null,selectedItem:null,previewPaneWidth:0,templateServer:"",dirty:!1,preview:{},main:{},channels:{},activeChannel:null}},methods:{GetTemplateUrl(t){if(!this.layout)return"";var e=y.buildUrl(this.templateServer,this.layout,t);return e},SetActiveChannel(t){console.log("SET ACTIVE CHANNEL ",t),this.activeChannel=t,Object.keys(this.channels).forEach(e=>{this.channels[e].active=!1}),t!=null&&(t.active=!0)},SavePlayList(){console.log("save playlist "),y.savePlayList(this.layoutName,this.playlistName,this.playlist).then(t=>{this.origPlayList=JSON.stringify(this.playlist),this.checkDirty(),console.log("success")},t=>{console.log("SHIT",t)})},GetRouteUrl(){var t=this.$router.resolve({name:"cgtest"});return t.href},isObject(t){return t!=null&&typeof t=="object"},isDeepEqual(t,e){const r=Object.keys(t),a=Object.keys(e);if(r.length!==a.length)return!1;for(var i of r){const s=t[i],f=e[i],n=this.isObject(s)&&this.isObject(f);if(this.isObjects&&!this.isDeepEqual(s,f)||!n&&s!==f)return!1}return!0},LoadPlayList(){this.loading=!1,console.log("load playlist ",this.layoutName,this.playlistName),y.getPlayList(this.layoutName,this.playlistName).then(t=>{this.playlist=t,this.origPlayList=JSON.stringify(t)}),y.getLayoutDefinition(this.layoutName).then(t=>{console.log("GetLayoutDefinition ok"),this.layout=t,this.loading=!1,this.resizeViewers()},t=>{console.log("AN ERROR OCCURED ",t)})},GetQueryParameters(){return this.$route.query},setViewersRatio(t){this.viewersRatio=t,setTimeout(()=>{this.resizeViewers()},0)},GetCurrentChannel(){return this.activeChannel},SendCommand(t,e,r,a,i,s,f){switch(console.log("send command ",e,"/",a," on layer ",r),i&&i=="off"&&(f=!0),r||(r="default"),e){case"cls":t.state={};break;case"play":f?delete t.state[r]:t.state[r]={template:a,action:i,data:s};break}setTimeout(()=>{switch(t.mode){case"direct":var n=this.$refs[t.channel];console.log("frame = ",n);var m={command:e,page:a,action:i,data:b(s),layer:r};n.contentWindow.postMessage(m,"*");break;default:console.log("lala??"),y.command(t,e,r,a,i,s==null?null:b(s));break}},0)},processCommand(t){console.log("process command",t);var e=this.GetCurrentChannel();if(e!=null){var r=t.item;switch(t.action){case"off":this.SendCommand(e,"play",r.layer,null,"off",null,!0);break;default:this.SendCommand(e,"play",r.layer,r.template,r.action,r.data,!1);break}}},ObjectChanged(t,e){console.log("change occured",e),this.selectedItem!=null&&(this.selectedItem.data=e)},OpenObjectEditor(){var t=this.$refs.objEditor;console.log("ok? ",t),t.Edit(this.obj,this.definition,"Hello").then(e=>{console.log("object editor reply: ",e),e.key=="OK"&&(this.obj=e.data)})},GetTemplate(){y.get("WBD").then(t=>{this.template=t,console.log("resolution of template: ",this.template)})},setBackground(t,e){w.set(this.$refs[t],{"background-color":e})},getElementWidth(t){var e=getComputedStyle(t),r=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),a=parseFloat(e.borderLeftWidth)+parseFloat(e.borderRightWidth);return t.offsetWidth-r-a},checkDirty(){this.playlist?this.dirty=JSON.stringify(this.playlist)!==this.origPlayList:this.dirty=!1},takeIn(t){var e=this.preview.state[t];e&&this.SendCommand(this.main,"play",t,e.template,e.action,e.data)},takeOut(t){var e=this.main.state[t];e&&this.SendCommand(this.main,"play",t,null,"off",null,!0)},resizeViewers(){var t=this.$el.querySelectorAll(".viewer");console.log("resize viewers",t.length),t.forEach(e=>{if(this.layout){var r=this.getElementWidth(e.parentNode),a=this.layout.resolution[0]/this.layout.resolution[1],i=r/this.layout.resolution[0];console.log("viewer ",r,this.layout.resolution[0],a);var s=e.querySelectorAll("iframe");console.log("IFrame ",r,r/a),w.set(e,{width:r,height:r/a}),w.set(s,{scale:i,width:this.layout.resolution[0],height:this.layout.resolution[1]})}})}},mounted:function(){this.templateServer=this.$route.query.ts,this.preview=y.parseChannel(this.$route.query.p,"preview","Preview"),this.main=y.parseChannel(this.$route.query[1],"main","Main"),this.SetActiveChannel(this.preview),this.channels.P=this.preview,this.channels[1]=this.main,console.log("document ",document),document.addEventListener("keydown",e=>{if(e.key=="F1")return console.log("keydown: ",e.key,e,this.preview),this.takeIn("default"),e.preventDefault(),!1;if(e.key=="F2")return console.log("keydown: ",e.key,e),this.takeOut("default"),e.preventDefault(),!1},!0),console.log("playlist mounted: ",this.$route.query),this.$route.query.env&&O.setEnv(this.$route.query.env),this.layoutName=this.$route.params.layout,this.playlistName=this.$route.params.playlist,this.LoadPlayList(),this.resizeObserver=new ResizeObserver(e=>{var r=e[0];w.set(this.$refs.previewPane,{width:r.contentRect.width});for(let a of e)console.log(`Size changed! New size: ${a.contentRect.width}px by ${a.contentRect.height}px`),this.previewPaneWidth=a.contentRect.width,this.resizeViewers()});var t=this.$refs.previewPaneParent;t&&this.resizeObserver.observe(t),this.dirtyInterval=setInterval(()=>this.checkDirty(),2e3)},beforeUnmount(){console.log("stop resize observer"),this.resizeObserver.unobserve(),this.dirtyInterval&&clearTimeout(this.dirtyInterval),hotkeys.unbind()},created:function(){}},T={style:{display:"flex",width:"100%"}},V={key:0},j={ref:"previewPaneParent",style:{"xbackground-color":"pink",flex:"1"}},B={key:0,class:"mb-2",style:{"background-color":"#ddd",display:"flex","align-items":"center"}},I={style:{padding:"8px"}},D=l("br",null,null,-1),G={style:{"padding-left":"50px"}},q={ref:"previewPane",style:{position:"fixed","xbackground-color":"pink",width:"100%"}},U={style:{display:"flex",width:"100%"}},W={style:{position:"relative",padding:"5px","margin-top":"8px",overflow:"hidden"}},A=["src"],F=["href"],H=l("thead",null,[l("tr",null,[l("td",null,"Layer"),l("td",null,"Scene")])],-1),J={class:"text-right"},K={style:{position:"relative",padding:"5px","margin-top":"8px",overflow:"hidden"}},M=["src"],X=["href"],Q=l("thead",null,[l("tr",null,[l("td",null,"Layer"),l("td",null,"Scene")])],-1),Y={class:"text-right"};function Z(t,e,r,a,i,s){const f=L("PlaylistItemRoot");return v(),p("div",null,[l("div",T,[l("div",{style:k([{"background-color":i.dirty?"#ffdddd":""},{"max-width":"400px","min-width":"400px","padding-left":"8px","padding-right":"8px","min-height":"100vh"}])},[i.playlist?(v(),p("div",V,[i.playlist?(v(),x(f,{key:0,onCommand:s.processCommand,layout:i.layout,item:i.playlist},null,8,["onCommand","layout","item"])):g("",!0),i.dirty?(v(),x(d,{key:1,onClick:e[0]||(e[0]=n=>s.SavePlayList()),color:"primary",block:""},{default:u(()=>[h("Save")]),_:1})):g("",!0)])):g("",!0)],4),l("div",j,[i.layout?(v(),p("div",B,[l("div",I,[h(" Resolution: "),l("b",null,c(i.layout.resolution[0])+" x "+c(i.layout.resolution[1]),1),D,h(" Layout: "),l("b",null,c(i.layout.layout),1)]),l("div",G,[o(d,{class:"mr-1",size:"small",onClick:e[1]||(e[1]=n=>s.setViewersRatio(.5))},{default:u(()=>[h("50/50")]),_:1}),o(d,{class:"mr-1",size:"small",onClick:e[2]||(e[2]=n=>s.setViewersRatio(.3))},{default:u(()=>[h("30/70")]),_:1}),o(d,{size:"small",onClick:e[3]||(e[3]=n=>s.setViewersRatio(.7))},{default:u(()=>[h("70/30")]),_:1})])])):g("",!0),l("div",q,[l("div",U,[l("div",{style:k([{width:this.viewersRatio*100+"%"},{padding:"5px",overflow:"hidden"}])},[l("h3",null,c(i.preview.name)+" ("+c(i.preview.title)+") ",1),o(d,{size:"small",onClick:e[4]||(e[4]=n=>s.setBackground("viewer1","#000000"))},{default:u(()=>[h("black")]),_:1}),o(d,{size:"small",onClick:e[5]||(e[5]=n=>s.setBackground("viewer1","#ffffff"))},{default:u(()=>[h("white")]),_:1}),o(d,{size:"small",onClick:e[6]||(e[6]=n=>s.setBackground("viewer1","#ff0000"))},{default:u(()=>[h("red")]),_:1}),o(d,{size:"small",onClick:e[7]||(e[7]=n=>s.setBackground("viewer1","#aaaaaa"))},{default:u(()=>[h("grey")]),_:1}),o(d,{size:"small",color:"red",onClick:e[8]||(e[8]=n=>s.SendCommand(i.preview,"cls"))},{default:u(()=>[h("Clear")]),_:1}),l("div",W,[l("div",{class:S(["viewer",{"viewer-active":i.preview.active}]),ref:"viewer1",style:{position:"relative"}},[l("div",{onClick:e[9]||(e[9]=_(n=>s.SetActiveChannel(i.preview),["stop"])),style:{"z-index":"10",position:"absolute",width:"100%",height:"100%"}}),l("iframe",{ref:"preview",class:"cg-scaled-frame","scrolling:":"no",src:s.GetTemplateUrl(i.preview)},null,8,A)],2)]),l("a",{class:"app-link text-primary",href:s.GetTemplateUrl(i.preview),target:"_blank"},c(s.GetTemplateUrl(i.preview)),9,F),o(z,{density:"compact",hover:""},{default:u(()=>[H,l("tbody",null,[(v(!0),p(R,null,P(i.preview.state,(n,m)=>(v(),p("tr",{key:m},[l("td",null,c(m),1),l("td",null,c(n.template),1),l("td",J,[o(d,{size:"x-small",color:"warning",onClick:C=>{s.SendCommand(i.preview,"play",m,null,"off",null,!0)},icon:"mdi-minus"},null,8,["onClick"]),o(d,{size:"x-small",class:"ml-2",xcolor:"primary",onClick:C=>s.takeIn(m),icon:"mdi-chevron-right"},null,8,["onClick"])])]))),128))])]),_:1})],4),l("div",{style:k([{width:(1-this.viewersRatio)*100+"%"},{padding:"5px",overflow:"hidden"}])},[l("h3",null,c(i.main.name)+" ("+c(i.main.title)+")",1),o(d,{size:"small",onClick:e[10]||(e[10]=n=>s.setBackground("viewer2","#000000"))},{default:u(()=>[h("black")]),_:1}),o(d,{size:"small",onClick:e[11]||(e[11]=n=>s.setBackground("viewer2","#ffffff"))},{default:u(()=>[h("white")]),_:1}),o(d,{size:"small",onClick:e[12]||(e[12]=n=>s.setBackground("viewer2","#ff0000"))},{default:u(()=>[h("red")]),_:1}),o(d,{size:"small",onClick:e[13]||(e[13]=n=>s.setBackground("viewer2","#aaaaaa"))},{default:u(()=>[h("grey")]),_:1}),o(d,{size:"small",color:"red",onClick:e[14]||(e[14]=n=>s.SendCommand(i.main,"cls"))},{default:u(()=>[h("Clear")]),_:1}),l("div",K,[l("div",{class:S(["viewer",{"viewer-active":i.main.active}]),ref:"viewer2"},[l("div",{onClick:e[15]||(e[15]=_(n=>s.SetActiveChannel(i.main),["stop"])),style:{"z-index":"10",position:"absolute",width:"100%",height:"100%"}}),l("iframe",{ref:"main",style:{position:"relative",display:"relative"},class:"cg-scaled-frame","scrolling:":"no",src:s.GetTemplateUrl(i.main)},null,8,M)],2)]),l("a",{class:"app-link text-primary",href:s.GetTemplateUrl(i.main),target:"_blank"},c(s.GetTemplateUrl(i.main)),9,X),o(z,{density:"compact",hover:""},{default:u(()=>[Q,l("tbody",null,[(v(!0),p(R,null,P(i.main.state,(n,m)=>(v(),p("tr",{key:m},[l("td",null,c(m),1),l("td",null,c(n.template),1),l("td",Y,[o(d,{size:"x-small",color:"warning",onClick:C=>{s.SendCommand(i.main,"play",m,null,"off",null,!0)},icon:"mdi-minus"},null,8,["onClick"])])]))),128))])]),_:1})],4)])],512)],512)])])}const te=N(E,[["render",Z]]);export{te as default};
